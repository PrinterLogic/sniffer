#!/usr/bin/env php
<?php
require('./vendor/autoload.php');

$path = __DIR__ . '/../../../../';
$exit = 0;

$commitSHA = substr(`cd $path && git rev-parse HEAD`, 0, 8);
dump($commitSHA);

$finder = new Ayeo\Sniffer\ChangedFilesFinder($path);
$files = $finder->findAll($commitSHA);
//dump($files);

$sniffer = new Ayeo\Sniffer\Sniffer($path, $path . '/phpcs.xml');
//dump($sniffer);

/* @var $file \Ayeo\Sniffer\File */
foreach ($files as $file) {
    echo sprintf("\nFile: %s\n", $file->getFileFullPath());
    $report = $sniffer->getReport($file);

    /* @var $row \Ayeo\Sniffer\ReportRow */
    foreach ($report as $row) {
        dump($row->getLineNumber());
        dump(($file->isChanged($row->getLineNumber())));
        if ($file->isChanged($row->getLineNumber())) {
            echo sprintf("| %s | %s\t| %s\n", $row->getLineNumber(), $row->getType(), $row->getMessage());
        }
    }
}

exit($exit);
